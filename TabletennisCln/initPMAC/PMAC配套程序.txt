CLOSE
END GATHER
DELETE GATHER
DELETE TRACE

;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------
; X，Z 轴简单的位置调节
;
OPEN PROG 11 CLEAR
	RAPID								; 在RAPID模式下，由上位机发送在线命令控制机器人
	ABS
	P3=1									; 程序运行标志
	WHILE(P3=1)
		IF(P4=0)							; 若y轴进入回位过程，则x，z复位
			X0Z0
		END IF
	END WHILE
	X0Z0									; x,z 复位
CLOSE

;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------
; 加入击球瞬间X，Z轴的方向调整
OPEN PROG 12 CLEAR
	RAPID
	ABS
	P3=1
	P62=600	
	
	WHILE(P3=1)
		IF(P4=1)
			I5211=(P31-20)*8388608/I10		; 对切球的延迟
			WHILE(I5211>0)
			END WHILE
			
			LINEAR
			INC
			TA(20)
			TS(7.5)
			F(P62)
			X20Z20
			P41=0
			P4=0
			RAPID
			ABS
		END IF
		
		IF(P4=0)
			X0Z0
		END IF
	END WHILE
	X0
CLOSE
;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------
; Y 轴击球程序第一版
; p3 	程序开始标志
; p4 	击球信号
; p71	击球最大速度
; p91  击球加速时间
; p92  回位加速时间
; p8   击球距离
; p73  击球等待时间
OPEN PROG 13 CLEAR
	LINEAR
	P3=1
	P4=0
	P71=1800
	P91=325
	P92=400
	P8=600
	P81=600
	P101=0
	P102=0
	P72=0
	P93=2.5
	WHILE(P3=1)
		IF(P4=1)
			P101=0
			P102=0
			P73=P72-(P91+(P8/P71))/2
			IF(P73>0)
				DWELL(P73)
			END IF
			F(P71)
			TA(P91)
			TS(P91/P93)
			Y(P8)
			DWELL0
			P4=0
			P101=1
			TA(P92)
			TS(P92/2)
			Y0
			DWELL0
			COMMAND"ENDG"
			P102=1
			P72=0
		END IF
	END WHILE
CLOSE
;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------
; Y 轴击球程序第二版
; p3 	程序开始标志
; p42 	击球信号
; p71   击球距离
; P72	击球最大速度
; P73  击球加速时间
; P74  回位加速时间

OPEN PROG 14 CLEAR
	LINEAR
	P3=1
	P42=0
	P71=600
	P72=1800
	P73=340
	P74=400
	P101=0
	P102=0
	WHILE(P3=1)
		IF(P42=1)
		P101=0
		P102=0
		F(P72)
		TA(P73)
		TS(P73/2.5)
		Y(P71)
		DWELL0
		P42=0
		P101=1
		TA(P74)
		TS(P74/2)
		Y0
		DWELL0
		COMMAND"ENDG"
		P102=1
		END IF
	END WHILE
CLOSE
;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------
; Y 轴击球程序第三版
; p3 	程序开始标志
; p31   Y轴回球等待时间，初步设定
; I5212 Y轴回球等待时间，自减 
; p4 	击球信号
; p71   击球距离
; P72	击球最大速度
; P73   击球加速时间
; P74   回位加速时间


OPEN PROG 15 CLEAR
	LINEAR
	P3=1
	P4=0
	P71=600
	P72=1800
	P73=340
	P74=400
	P101=0
	P102=0
	WHILE(P3=1)
		IF(P4=1)
			I5212=(P31-(P73+P71/P72)/2)*8388608/I10
			WHILE(I5212>0)
			END WHILE
			
			P101=0
			P102=0
			F(P72)
			TA(P73)
			TS(P73/2.5)
			Y(P71)
			DWELL0
			;--------------------------------
			P4=0
			P101=1
			TA(P74)
			TS(P74/2)
			Y0
			DWELL0
			;--------------------------------
			COMMAND"ENDG"
			P102=1
		END IF
	END WHILE
CLOSE
;------------------------------------------------------------------------------------------
;------------------------------------------------------------------------------------------

;------------------------------------------------------------------------------------------
; 复位程序
OPEN PLC 1 CLEAR

I7000=1001
I7001=5
I7002=3
I7003=1746
I7016=0
I169=1001
I10=3421867
I7010=3
;---------------------------------------------------------
I7012=14			; 编码器捕捉选项
I7013=0
I116=400			; #1 最大速度				单位 cnts/ms    默认 32 
I119=2				; #1 最大jog 加速度         单位 cnts/ms^2  默认 0.1526 
I120=0				; #1 jog/home 加速时间      单位 ms         默认 0 				 （ 设为0时，由Ixx21控制， 实际值为 2*Ixx21 ）
I121=20				; #1 jog/home S曲线时间     单位 ms         默认 50  			 （ RAPID 模式也可使用 ）
I122=50 			; #1 jog 速度               单位 cnts/ms    默认 32              （ Ixx90设为0时，RAPID 模式也采用这一速度 ）
I123=-5				; #1 home 速度与方向        单位 cnts/ms    默认 32              （ +/- 确定方向 ）
I126=800*187.5*16	; #1 home Offset     		单位 1/16 cnt   默认 0				 （ 这里设为球桌正中心 )
I114=-160000		; #1 负限位软开关位置  		单位 cnts       默认 0 				 （disabled）
I190=1				; #1 RAPID模式设置          选择0 则RAPID模式下速度为Ixx22控制
					;							选择1 则RAPID模式下速度为Ixx16控制
					;                           不论如何选择，加速度由Ixx19 - Ixx21控制。
;---------------------------------------------------------
I7022=14			; 编码器捕捉选项
I7023=0
I219=0.015625		; #2 最大jog 加速度         单位 cnts/ms^2  默认 0.1526
I220=0				; #2 jog/home 加速时间      单位 ms         默认 0 				 （ 设为0时，由Ixx21控制， 实际值为 2*Ixx21 ）
I221=50				; #2 jog/home S曲线时间     单位 ms         默认 50  			 （ RAPID 模式也可使用 ）
I223=-5				; #2 home 速度与方向        单位 cnts/ms    默认 32        	     （ +/- 确定方向 ）
I226=200*137.05*16  ; #2 home Offset     		单位 1/16 cnt   默认 0				 （ 这里设为球桌正中心 )
I214=-30000			; #2 负限位软开关位置  		单位 cnts       默认 0 				 （disabled）
I290=0				; #2 RAPID模式设置          选择0 则RAPID模式下速度为Ixx22控制
					;							选择1 则RAPID模式下速度为Ixx16控制
					;                           不论如何选择，加速度由Ixx19 - Ixx21控制。
;---------------------------------------------------------
I7032=14			; 编码器捕捉选项
I7033=0				
I316=100			; #3 最大速度				单位 cnts/ms    默认 32 
I317=2				; #3 最大加速度				单位 cnts/ms^2  默认 32 
I319=2				; #3 最大jog 加速度         单位 cnts/ms^2  默认 0.1526
I320=0				; #3 jog/home 加速时间      单位 ms         默认 0 				 （ 设为0时，由Ixx21控制， 实际值为 2*Ixx21 ）
I321=10				; #3 jog/home S曲线时间     单位 ms         默认 50  			 （ RAPID 模式也可使用 ）
I322=50				; #3 jog 速度               单位 cnts/ms    默认 32              （ Ixx90设为0时，RAPID 模式也采用这一速度 ）
I323=5				; #3 home 速度与方向        单位 cnts/ms    默认 32        	     （ +/- 确定方向 ）
I326=-20000*16		; #3 home Offset     		单位 1/16 cnt   默认 0				 （ 这里设为球桌正中心 )
I390=1				; #3 RAPID模式设置          选择0 则RAPID模式下速度为Ixx22控制
					;							选择1 则RAPID模式下速度为Ixx16控制
					;                           不论如何选择，加速度由Ixx19 - Ixx21控制。
;------------------------------------------------------------------------------------------
P1=1
P100=0
COMMAND"#1 HM"
COMMAND"#2 HM"
COMMAND"#3 HM"
WHILE(M145=0)
OR(M133=0)
END WHILE
WHILE(M245=0)
OR(M233=0)
END WHILE
WHILE(M345=0)
OR(M333=0)
END WHILE
P1=0
P100=1

;Data Gather 的选项
; I5000 Data Gathering Buffer Location and Mode
I5000=0 
; I5001 – I5048 Data Gathering Source 1-48 Address
I5001=$8000A5 ; #1 命令位置地址
I5002=$80008B ; #1 实际位置地址
I5003=$800125 ; #2 命令位置地址
I5004=$80010B ; #2 实际位置地址
I5005=$8001A5 ; #3 命令位置地址
I5006=$80018B ; #3 实际位置地址

I5049=10 ; Data Gathering Period  单位 servo Cycles 
I5050=$3F ; Data Gathering Selection Mask 1  ( HEX: 3F , 表示只采集最开始的6个变量 )
I5051=0  ; Data Gathering Selection Mask 2  ( HEX: 0 )
;---------------------------------------------------------

COMMAND"DEF GAT"
DISABLE PLC1
CLOSE


OPEN PLC 2 CLEAR
I7000=1001
I7001=5
I7002=3
I7003=1746
I7016=0
I169=1001
I10=3421867
I7010=3
;---------------------------------------------------------
I7012=14			; 编码器捕捉选项
I7013=0
I116=400			; #1 最大速度				单位 cnts/ms    默认 32 
I119=2				; #1 最大jog 加速度         单位 cnts/ms^2  默认 0.1526 
I120=0				; #1 jog/home 加速时间      单位 ms         默认 0 				 （ 设为0时，由Ixx21控制， 实际值为 2*Ixx21 ）
I121=20				; #1 jog/home S曲线时间     单位 ms         默认 50  			 （ RAPID 模式也可使用 ）
I122=50 			; #1 jog 速度               单位 cnts/ms    默认 32              （ Ixx90设为0时，RAPID 模式也采用这一速度 ）
I123=-5				; #1 home 速度与方向        单位 cnts/ms    默认 32              （ +/- 确定方向 ）
I126=800*187.5*16	; #1 home Offset     		单位 1/16 cnt   默认 0				 （ 这里设为球桌正中心 )
I114=-160000		; #1 负限位软开关位置  		单位 cnts       默认 0 				 （disabled）
I190=1				; #1 RAPID模式设置          选择0 则RAPID模式下速度为Ixx22控制
					;							选择1 则RAPID模式下速度为Ixx16控制
					;                           不论如何选择，加速度由Ixx19 - Ixx21控制。
;---------------------------------------------------------
I7022=14			; 编码器捕捉选项
I7023=0
I219=0.015625		; #2 最大jog 加速度         单位 cnts/ms^2  默认 0.1526
I220=0				; #2 jog/home 加速时间      单位 ms         默认 0 				 （ 设为0时，由Ixx21控制， 实际值为 2*Ixx21 ）
I221=50				; #2 jog/home S曲线时间     单位 ms         默认 50  			 （ RAPID 模式也可使用 ）
I223=-5				; #2 home 速度与方向        单位 cnts/ms    默认 32        	     （ +/- 确定方向 ）
I226=200*137.05*16  ; #2 home Offset     		单位 1/16 cnt   默认 0				 （ 这里设为球桌正中心 )
I214=-30000			; #2 负限位软开关位置  		单位 cnts       默认 0 				 （disabled）
I290=0				; #2 RAPID模式设置          选择0 则RAPID模式下速度为Ixx22控制
					;							选择1 则RAPID模式下速度为Ixx16控制
					;                           不论如何选择，加速度由Ixx19 - Ixx21控制。
;---------------------------------------------------------
I7032=14			; 编码器捕捉选项
I7033=0				
I316=100			; #3 最大速度				单位 cnts/ms    默认 32 
I317=2				; #3 最大加速度				单位 cnts/ms^2  默认 32 
I319=2				; #3 最大jog 加速度         单位 cnts/ms^2  默认 0.1526
I320=0				; #3 jog/home 加速时间      单位 ms         默认 0 				 （ 设为0时，由Ixx21控制， 实际值为 2*Ixx21 ）
I321=10				; #3 jog/home S曲线时间     单位 ms         默认 50  			 （ RAPID 模式也可使用 ）
I322=50				; #3 jog 速度               单位 cnts/ms    默认 32              （ Ixx90设为0时，RAPID 模式也采用这一速度 ）
I323=5				; #3 home 速度与方向        单位 cnts/ms    默认 32        	     （ +/- 确定方向 ）
I326=-20000*16		; #3 home Offset     		单位 1/16 cnt   默认 0				 （ 这里设为球桌正中心 )
I390=1				; #3 RAPID模式设置          选择0 则RAPID模式下速度为Ixx22控制
					;							选择1 则RAPID模式下速度为Ixx16控制
					;                           不论如何选择，加速度由Ixx19 - Ixx21控制。
;------------------------------------------------------------------------------------------
;Data Gather 的选项
; I5000 Data Gathering Buffer Location and Mode
I5000=0 
; I5001 – I5048 Data Gathering Source 1-48 Address
I5001=$8000A5 ; #1 命令位置地址
I5002=$80008B ; #1 实际位置地址
I5003=$800125 ; #2 命令位置地址
I5004=$80010B ; #2 实际位置地址
I5005=$8001A5 ; #3 命令位置地址
I5006=$80018B ; #3 实际位置地址

I5049=10 ; Data Gathering Period  单位 servo Cycles 
I5050=$3F ; Data Gathering Selection Mask 1  ( HEX: 3F , 表示只采集最开始的6个变量 )
I5051=0  ; Data Gathering Selection Mask 2  ( HEX: 0 )
;---------------------------------------------------------
; 初始化各项标志位
P100=0
P101=0
P102=0
P103=0
P104=0
COMMAND"DEF GAT"
DISABLE PLC2
CLOSE


OPEN PLC 3 CLEAR
P3=1
P42=0
P31=500
COMMAND"&2 B12 R"
COMMAND"&4 B14 R"
WHILE(P3=1)
IF(P4=1)
P32=P31-(P73+(P71/P72))/2
P33=P31-20
I5211=P32*8388608/I10
I5212=P33*8388608/I10
WHILE(I5211>0)
END WHILE
P42=1
WHILE(I5212>0)
END WHILE
P41=1
WHILE(P4=1)
END WHILE
END IF
END WHILE
DISABLE PLC3
CLOSE

;===============================================

